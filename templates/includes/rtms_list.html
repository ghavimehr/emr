{# emr/templates/emr/oneglance.html #}

{% load static %}

<div class="document-box bg-gray-50 dark:bg-gray-700 p-4 rounded-lg overflow-y-auto max-h-64" dir="ltr">
  {% if rtms_list %}
    <table class="min-w-full text-left text-sm">
      <thead class="text-gray-700 dark:text-gray-300">
        <tr class="bg-gray-100 bg-gray-800">
          <th>row</th>
          <th>Start Power</th>
          <th>Power</th>
          <th>Variable 1</th>
          <th>Variable 2</th>
          <th>Pulse Type</th>
          <th>Total Pulses</th>
          <th>Total Sessions</th>
          <th>Areas</th>
        </tr>
      </thead>
      <tbody class="text-gray-700 dark:text-gray-300">
        {% for rtms in rtms_list %}
        <tr class="{% cycle 'bg-white' 'bg-gray-100' %} dark:{% cycle 'bg-gray-700' 'bg-gray-800'%}">
          <td>{{ forloop.counter }}</td>
          <td>{{ rtms.first_power }}%</td>
          <td>{{ rtms.power|default_if_none:"---" }}%</td>
          <td>{{ rtms.unknown_1 }}</td>
          <td>{{ rtms.unknown_2 }}</td>
          <td>{{ rtms.pulse_type }}</td>
          <td>{{ rtms.total_pulse }}</td>
          <td>{{ rtms.total_sessions }}</td>
          <td>
            <table>
              <tbody>
                {% for area in rtms.areas %}
                <tr>
                    <td>{{ area.name }}</td>
                    <td class="text-right">{{ area.value }} %</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
            </a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-sm text-gray-600 dark:text-gray-300">
      No rTMS treatments recorded for this patient.
    </p>
  {% endif %}
</div>










<!-- {% for rtms in rtms_list %}
  <div class="rtms-card relative border rounded-lg p-4 mb-6 bg-white">
    {# — Top row: formula + optional (PulseType) in red — #}
    <div class="flex justify-between items-start">
      <div class="flex items-center">
        <span class="text-base">
          {{ rtms.first_power }} % MT × {{ rtms.unknown_1 }} × {{ rtms.unknown_2 }}
        </span>
        {% if rtms.pulse_type and rtms.pulse_type.id != 1 %}
          <span class="ml-2 text-red-600">( {{ rtms.pulse_type.name }} )</span>
        {% endif %}
      </div>

      {# — Right side: variable-length list of “areas” — #}
      <div class="grid grid-cols-1 gap-1 text-sm text-right">
        {% for area in rtms.areas %}
          <div>{{ area.name }}: {{ area.value }} %</div>
        {% endfor %}
      </div>
    </div>

    {# — The horizontal “scratch” line — #}
    <hr class="my-2 border-t-2 border-gray-300" />

    {# — Big total_pulse — #}
    <div class="text-2xl font-extrabold">
      {{ rtms.total_pulse }}
    </div>

    {# — Bottom-right corner: N = total_sessions — #}
    <div class="absolute bottom-2 right-4 text-lg font-bold">
      N = {{ rtms.total_sessions }}
    </div>
  </div>
{% empty %}
  <p class="text-gray-600">No rTMS sessions recorded.</p>
{% endfor %} -->
