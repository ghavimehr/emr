{% extends "layouts/my-base-dashboard.html" %}
{% load i18n %}
{% load static %}
{% load direction_tags %}

{% block extrastyle %}
<link rel="stylesheet" href="{% static "dist/jquery.multi-select.css" %}">

{% endblock extrastyle %}

{% block content %}
<div class="grid grid-cols-1 px-4 pt-6 xl:grid-cols-3 xl:gap-4 dark:bg-gray-900">
  <div class="mb-4 col-span-full xl:mb-2">
      <h1 class="text-xl font-semibold text-gray-900 sm:text-2xl dark:text-white">
          {% trans "rTMS Overview" %}
      </h1>
  </div>

  <div class="col-span-3">
    <div class="p-4 mb-4 bg-white border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 sm:p-6 dark:bg-gray-800">
        <div class="flex items-center justify-between mb-8">
            <h3 class="mb-4 text-xl font-semibold dark:text-white">
                {% trans "All Orders" %}
            </h3>
            <a href="#" class="text-white bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">
                {% trans "add a record" %}
            </a>
        </div>

  <div class="col-span-3">
  <!-- Search / Filter Form -->
  <form method="get" class="bg-white p-4 rounded-lg shadow mb-4 flex flex-col space-y-4 dark:bg-gray-800">
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
      <div>
        <label for="patient_id" class="block text-sm font-medium text-gray-700 dark:text-gray-200">{% trans "Patient ID" %}</label>
        <input type="text" name="patient_id" id="patient_id" value="{{ search_params.patient_id }}" 
        class="mt-1 block w-48 p-2 border rounded dark:bg-gray-700 dark:text-white">
      </div>
      <div>
        <label for="pulse_type" class="block text-sm font-medium text-gray-700 dark:text-gray-200">{% trans "Pulse Type" %}</label>
        <input type="text" name="pulse_type" id="pulse_type" value="{{ search_params.pulse_type }}" 
        class="mt-1 block w-48 p-2 border rounded dark:bg-gray-700 dark:text-white">
      </div>
      <div>
        <label for="unknown_variable_1" class="block text-sm font-medium text-gray-700 dark:text-gray-200">{% trans "Unknown Variable 1" %}</label>
        <input type="text" name="unknown_variable_1" id="unknown_variable_1" value="{{ search_params.unknown_variable_1 }}" 
        class="mt-1 block w-48 p-2 border rounded dark:bg-gray-700 dark:text-white">
      </div>
      <div>
        <label for="unknown_variable_2" class="block text-sm font-medium text-gray-700 dark:text-gray-200">{% trans "Unknown Variable 2" %}</label>
        <input type="text" name="unknown_variable_2" id="unknown_variable_2" value="{{ search_params.unknown_variable_2 }}" 
        class="mt-1 block w-48 p-2 border rounded dark:bg-gray-700 dark:text-white">
      </div>
      <div>
        <label for="total_sessions" class="block text-sm font-medium text-gray-700 dark:text-gray-200"">{% trans "Total Sessions" %}</label>
        <input type="text" name="total_sessions" id="total_sessions" value="{{ search_params.total_sessions }}" 
        class="mt-1 block w-48 p-2 border rounded dark:bg-gray-700 dark:text-white">
      </div>
      <div>
        <label for="total_pulse" class="block text-sm font-medium text-gray-700 dark:text-gray-200"">{% trans "Total Pulse" %}</label>
        <input type="text" name="total_pulse" id="total_pulse" value="{{ search_params.total_pulse }}" 
        class="mt-1 block w-48 p-2 border rounded dark:bg-gray-700 dark:text-white">
      </div>
    </div>
    <div class="mt-4">
      <button type="submit" class="px-4 py-2 bg-primary-700 text-white rounded hover:bg-primary-800">
        {% trans "Search" %}
      </button>
    </div>
  </form>

  <!-- rTMS Records Table -->
  <div class="overflow-x-auto relative">
    <table class="w-full text-sm text-gray-500 dark:text-gray-400">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400 {% get_alignment %}">
        <tr>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Reference No" %}</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Patient" %}</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Pulse Type" %}</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Total Sessions" %}</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Total Pulse" %}</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Latest Event" %}</th>
          <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">{% trans "Actions" %}</th>
        </tr>
      </thead>
      <tbody>
        {% for rtms in rtms_list %}
        <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
          <td class="px-6 py-4 whitespace-nowrap">{{ rtms.pk }}</td>
          <td class="px-6 py-4 whitespace-nowrap">{{ rtms.identity_patient }}</td>
          <td class="px-6 py-4 whitespace-nowrap">
            {% if rtms.pulse_type %}{{ rtms.pulse_type.name }}{% else %}{% trans "N/A" %}{% endif %}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">{{ rtms.total_sessions }}</td>
          <td class="px-6 py-4 whitespace-nowrap">{{ rtms.total_pulse }}</td>
          <td class="px-6 py-4 whitespace-nowrap">
            {% if rtms.latest_event_date %}
              {{ rtms.latest_event_date }}<br>{{ rtms.latest_event_time }}
            {% else %}
              {% trans "No events" %}
            {% endif %}
          </td>
          <td class="px-6 py-4 whitespace-nowrap">

          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="7" class="px-6 py-4 text-center">{% trans "No rTMS records found." %}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="flex items-center justify-between mb-4 pt-4">
    <!-- Rows-per-page Selector (left side) -->
    <form method="GET" class="flex items-center space-x-2 rtl:space-x-reverse">
      <!-- Always reset to page=1 on change -->
      <input type="hidden" name="page" value="1">
      <label for="rows" class="font-medium text-gray-700 dark:text-gray-200">
        {% trans "Rows per page:" %}
      </label>
      <!-- Wider dropdown (w-28) -->
      <select
        name="rows"
        id="rows"
        class="w-28 bg-white border border-gray-300 text-gray-700 text-sm rounded-lg 
               focus:ring-2 focus:ring-primary-300 focus:border-primary-300
               p-2 dark:bg-gray-700 dark:border-gray-600 dark:text-white
               appearance-none"
        onchange="this.form.submit()"
      >
        <option value="10" {% if rtms_list.paginator.per_page == 10 %} selected {% endif %}>10</option>
        <option value="25" {% if rtms_list.paginator.per_page == 25 %} selected {% endif %}>25</option>
        <option value="50" {% if rtms_list.paginator.per_page == 50 %} selected {% endif %}>50</option>
      </select>
    </form>
    
    <!-- Pagination (right side) -->
    <nav class="flex items-center" aria-label="{% trans 'Page navigation' %}">
      <ul class="inline-flex items-center space-x-2 rtl:space-x-reverse">
        {% if rtms_list.has_previous %}
          <li>
            <a href="?page=1&rows={{ rtms_list.paginator.per_page }}{% for key, value in search_params.items %}{% if key != 'page' and key != 'rows' %}&{{ key }}={{ value }}{% endif %}{% endfor %}" 
               class="text-white bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 
                      font-medium rounded-lg text-sm px-5 py-2.5 text-center 
                      dark:bg-blue-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">
              {% trans "First" %}
            </a>
          </li>
          <li>
            <a href="?page={{ rtms_list.previous_page_number }}&rows={{ rtms_list.paginator.per_page }}{% for key, value in search_params.items %}{% if key != 'page' and key != 'rows' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
               class="text-white bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 
                      font-medium rounded-lg text-sm px-5 py-2.5 text-center 
                      dark:bg-blue-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">
              {% trans "Previous" %}
            </a>
          </li>
        {% else %}
          <li>
            <span class="text-gray-500 bg-gray-200 cursor-not-allowed font-medium rounded-lg text-sm px-5 py-2.5 text-center">
              {% trans "First" %}
            </span>
          </li>
          <li>
            <span class="text-gray-500 bg-gray-200 cursor-not-allowed font-medium rounded-lg text-sm px-5 py-2.5 text-center">
              {% trans "Previous" %}
            </span>
          </li>
        {% endif %}
        
        <li>
          <span class="text-gray-700 bg-white border border-gray-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center 
                       dark:bg-gray-700 dark:text-white dark:border-gray-600">
            {% trans "Page" %} {{ rtms_list.number }} {% trans "of" %} {{ rtms_list.paginator.num_pages }}
          </span>
        </li>
        
        {% if rtms_list.has_next %}
          <li>
            <a href="?page={{ rtms_list.next_page_number }}&rows={{ rtms_list.paginator.per_page }}{% for key, value in search_params.items %}{% if key != 'page' and key != 'rows' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
               class="text-white bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 
                      font-medium rounded-lg text-sm px-5 py-2.5 text-center 
                      dark:bg-blue-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">
              {% trans "Next" %}
            </a>
          </li>
          <li>
            <a href="?page={{ rtms_list.paginator.num_pages }}&rows={{ rtms_list.paginator.per_page }}{% for key, value in search_params.items %}{% if key != 'page' and key != 'rows' %}&{{ key }}={{ value }}{% endif %}{% endfor %}"
               class="text-white bg-primary-700 hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 
                      font-medium rounded-lg text-sm px-5 py-2.5 text-center 
                      dark:bg-blue-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">
              {% trans "Last" %}
            </a>
          </li>
        {% else %}
          <li>
            <span class="text-gray-500 bg-gray-200 cursor-not-allowed font-medium rounded-lg text-sm px-5 py-2.5 text-center">
              {% trans "Next" %}
            </span>
          </li>
          <li>
            <span class="text-gray-500 bg-gray-200 cursor-not-allowed font-medium rounded-lg text-sm px-5 py-2.5 text-center">
              {% trans "Last" %}
            </span>
          </li>
        {% endif %}
      </ul>
    </nav>
  </div>
  


</div>
</div>
</div>
</div>


{% endblock content %}

{% block extra_js %}
<script src="{% static "dist/js/jquery-2.2.4.min.js" %}"></script>
<script src="{% static "dist/js/jquery.multi-select.min.js" %}"></script>
<script>
    // Example script for future use if multi-select is implemented
    $('#id_example').multiSelect({
        'noneText': 'Select Options',
    });
</script>
{% endblock extra_js %}